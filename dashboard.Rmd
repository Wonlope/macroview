---
title: "Painel Macro"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source_code: NULL
    logo: logo.png
    social: menu
---


<style>                     
.navbar {
  background-color:#253F90;
}
</style> 


```{r setup, include=FALSE}

options(OutDec = ",")
knitr::opts_knit$set(progress = TRUE)


library(rmarkdown)
library(D3plusR)
library(tidyverse)
library(flexdashboard)
library(htmlwidgets)
library(kableExtra)


# Icons made by Freepik from www.flaticon.com

```

```{r dados, include=FALSE}

rdata <- c("./data/atividade.Rdata",
           "./data/fiscal.Rdata",
           "./data/inflacao.Rdata",
           "./data/internacional.Rdata",
           "./data/monetaria.Rdata",
           "./data/trabalho.Rdata")

purrr::map(rdata, ~ load(.x, .GlobalEnv))

```




Visão Geral {data-icon="fa-signal"}
=====================================

Este painel apresenta algumas informações básicas sobre a __conjuntura econômica brasileira__, organizadas em temas: nível de atividade, inflação, mercado de trabalho, políticas fiscal e monetária e economia internacional. Clique nos menus acima para navegar pelos temas e passe o mouse/clique nos gráficos interativos para opções de filtro de dados. Nota: divergências são provenientes de arredondamentos. __Última atualização__: `r format(Sys.Date(), format = "%d de %B de %Y")`.

Col {data-width=375}
-----------------------------------------------------------------------

### Evolução do PIB {.no-title}

```{r}
dic_pib_grafico <- list(
  valor = "Taxa",
  trimestre = "Trimestre",
  isolar = "Selecionar",
  ocultar = "Esconder")

pib_grafico %>%
  group_by(setores) %>%
  filter(row_number() >= (n() - 8)) %>%
  mutate(id = setores) %>% 
  rename(Taxa = valor, Trimestre = trimestre) %>%
  d3plus(data = .,
         id = "id",
         type = "line",
         percent_var = "Taxa",
         locale = "pt_BR",
         number_text = "%",
         dictionary = dic_pib_grafico) %>% 
  d3plusX("Trimestre", grid = FALSE) %>% 
  d3plusY("Taxa") %>% 
  d3plusOrder("Trimestre", sort = "asc") %>% 
  d3plusTooltip(c("Trimestre", "Taxa")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id"), size = 60) %>%
  d3plusColor("id") %>%
  d3plusTitle(value = "Crescimento do PIB e setores",
              sub = "Taxa acumulada em 4 trimestres (CNT/IBGE)",
              font = list(size = 13, weight = 800))
```


### Composição das Receitas e Despesas {.no-title}

```{r}
dic_comp_rec_desp <- list(periodo = "Mês",
                          valor = "Valor",
                          categoria_1 = "Categoria-Mãe",
                          categoria_2 = "Categoria-Filha 1",
                          categoria_3 = "Categoria-Filha 1",
                          isolar = "Selecionar",
                          ocultar = "Esconder",
                          `participação` = "% da Categoria")

d3plus(data = comp_rec_desp,
       type = "tree_map",
       id = c("categoria_1", "categoria_2", "categoria_3"),
       width = "100%",
       height = 500,
       number_text = c("Bilhões", "Trilhão", "Trilhões"),
       dictionary = dic_comp_rec_desp,
       locale = "pt_BR") %>% 
  d3plusSize(value = "valor") %>% 
  d3plusLegend(value = FALSE, order = list(sort = "desc", value = "size")) %>% 
  d3plusColor("categoria_1") %>% 
  d3plusDepth(0) %>% 
  d3plusTooltip(c("periodo", "valor")) %>%
  d3plusTitle(value = "Desagregação de Receitas e Despesas do Governo Central",
              sub = "Valores acumulados em 12 meses e deflacionados pelo IPCA (STN e IBGE)",
              font = list(size = 13, weight = 800)) %>%
  d3plusLabels(valign = "top")
```


Col {data-width=450}
-----------------------------------------------------------------------

### Inflação por Região Metropolitana {.no-title}

```{r}
dic_ipca_regiao <- list(periodo = "Período",
                        valor = "Taxa",
                        regiao = "Região Metropolitana",
                        isolar = "Selecionar",
                        ocultar = "Esconder")

filtro_ipca_regiao <- dados_ipca_regiao %>%
  filter(regiao == tail(regiao, 1) & row_number() >= (n() - 12)) %>%
  select(periodo) %>%
  pull(periodo)

d3plus(data = dados_ipca_regiao %>%
                mutate(sigla = recode(regiao,
                                       "Belém - PA" = "BEL",
                                       "Fortaleza - CE" = "FOR",
                                       "Recife - PE" = "REC",
                                       "Salvador - BA" = "SAL",
                                       "Belo Horizonte - MG" = "BH",
                                       "Grande Vitória - ES" = "GV",
                                       "Rio de Janeiro - RJ" = "RJ",
                                       "São Paulo - SP" = "SP",
                                       "Curitiba - PR" = "CUR",
                                       "Porto Alegre - RS" = "POA")),
       type = "bar",
       id = c("regiao", "sigla"),
       width = "100%",
       height = 500, 
       number_text = "%",
       locale = "pt_BR",
       noformat_number_var = "periodo",
       percent_var = "valor",
       dictionary = dic_ipca_regiao) %>%
  d3plusX(value = "periodo", grid = FALSE) %>%
  d3plusY(value = "valor", grid = TRUE) %>% 
  d3plusOrder("periodo", sort = "asc") %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = list(width = 0))) %>%
  d3plusTooltip(c("periodo", "valor")) %>% 
  d3plusColor("sigla") %>% 
  d3plusTime("periodo", solo = filtro_ipca_regiao) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "sigla"), size = 35) %>%
  d3plusTitle(value = "IPCA por região (IBGE)",
              sub = "Variação acumulada no ano (%)",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.regiao}).draw();
            }
          })
  }')
```


### Juros Real ex-ante e ex-post {.no-title}

```{r}
dic_juros_real <- list(data = "Período",
                       valor = "Taxa",
                       isolar = "Selecionar",
                       ocultar = "Esconder")

filtro_juros_real <- juros_real %>%
  filter(id == first(id)) %>%
  slice(tail(row_number(), 72)) %>%
  pull(data)

d3plus(data = juros_real,
       type = "line",
       id = "id",
       dictionary = dic_juros_real,
       locale = "pt_BR",
       percent_var = "valor",
       number_text = "%",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "data", label = "Período", grid = FALSE) %>% 
  d3plusY("valor", label = "Taxa") %>% 
  d3plusOrder(value = "data", sort = "asc") %>% 
  d3plusTime("data", solo = filtro_juros_real) %>%
  d3plusTooltip(value = c("data", "valor")) %>% 
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id", sort = "asc"), size = 35) %>%
  d3plusColor("id") %>%
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Taxa de Juros Real ex-ante e ex-post",
              sub = "Taxa em % a.a. (B3, BCB e IBGE)",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.id}).draw();
            }
          })
  }')
```


Col {data-width=375}
-----------------------------------------------------------------------

### Desemprego por UF {.no-title}

```{r}
d3plus(data = desemprego_map,
         type = "geo_map",
         locale = "pt_BR",
         percent_var = "tx_desemprego",
         id = "uf_id",
         currency = "US$",
         number_text = num_txt_desemprego_map,
         dictionary = dicionario_desemprego_map) %>% 
  d3plusCoords(value = "https://gist.githubusercontent.com/schoulten/93ed632d8e8b9be7a579f5cb20b20c04/raw/ae9f2c8338d1a9eddf95e03b62bfd7541ca5f980/br-states.json",
               projection = "equirectangular") %>% 
  d3plusColor(value = "tx_desemprego", heatmap = RColorBrewer::brewer.pal(n = 6, name = "YlOrBr")) %>% 
  d3plusText("uf") %>% 
  d3plusTooltip(value = c("trimestre", "pessoas_ocupadas", "pessoas_desocupadas", "tx_desemprego")) %>%
  d3plusTitle(value = "Taxa de Desemprego por Estados (%)",
              font = list(size = 13, weight = 800))
```


### Evolução do PIB por países {.no-title}

```{r}
dic_pib_ocde <- list(
  valor = "Taxa",
  periodo = "Trimestre",
  observacao = "Observação",
  pais = "País",
  isolar = "Selecionar",
  ocultar = "Esconder")

d3plus(data = pib_ocde %>%
                group_by(codigo) %>%
                slice_tail(n = 8) %>%
                filter(codigo %in% c("ARG", "CHL", "MEX", "CHN", "ESP", "RUS", "USA")),
       id = "codigo",
       type = "line",
       percent_var = "valor",
       locale = "pt_BR",
       number_text = "%",
       dictionary = dic_pib_ocde) %>% 
  d3plusX("periodo", grid = FALSE) %>% 
  d3plusY("valor") %>% 
  d3plusOrder("periodo", sort = "asc") %>% 
  d3plusTooltip(c("pais", "periodo", "valor", "observacao")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id"), size = 40) %>%
  d3plusColor("codigo") %>%
  d3plusTitle(value = "PIB: crescimento por países",
              sub = "Taxa de crescimento comparada com mesmo trimestre do ano anterior, sazonalmente ajustada (OCDE)",
              font = list(size = 13, weight = 800))

```


Nível de Atividade {data-navmenu="Explorar" data-icon="fa-chart-line"}
=====================================

Col {data-width=375}
-----------------------------------------------------------------------


### Crescimento do PIB em 4 trimestres

```{r}
pib_crescimento %>% 
  mutate(valor = paste0(valor, "%")) %>% 
  pull(valor) %>% 
  valueBox(value = ., icon = 'fa-chart-line', color =  ifelse(. < 0, "warning", "success"))
```


### PIB a preços correntes em 4 trimestres

```{r}
pib_nominal %>% 
  mutate(n = paste0("R$ ", n, " trilhões")) %>% 
  pull(n) %>% 
  valueBox(value = ., icon = 'fa-dollar-sign', color = "success")
```


### Índice Cielo do Varejo (`r format(as.Date(icva$date), format = "%B/%y")` - ICVA)
```{r}
icva %>%
  mutate(real_sa = paste0(real_sa, "%")) %>% 
  pull(real_sa) %>% 
  valueBox(value = ., icon = 'fa-store', color =  ifelse(. < 0, "warning", "success"))
```

### Produção de Veículos (`r format(tail(as.Date(veiculos$dates), 1), format = "%B/%y")` - ANFAVEA)

```{r}
veiculos %>%
  slice_tail(n = 1) %>%
  mutate(producao = paste0(round(producao/1000, digits = 2) %>% format(decimal.mark = ","), " mil")) %>%
  pull(producao) %>%
  valueBox(value = ., icon = 'fa-car', color =  ifelse(. < max(veiculos$producao)/2, "warning", "success"))
```


### Utilização da Capacidade Instalada (`r format(tail(as.Date(dados_uci_sa$date), 1), format = "%B/%y")` - FGV)

```{r}
gauge(as.numeric(uci), min = 0, max = 100, symbol = '%',
      gaugeSectors(success = c(85, 100),
                   warning = c(50, 85),
                   danger = c(0, 50)))
```



Col {data-width=575}
-----------------------------------------------------------------------


### Evolução do PIB {.no-title}

```{r, fig.height=4}
pib_grafico %>%
  group_by(setores) %>%
  filter(row_number() >= (n() - 12)) %>%
  mutate(id = setores) %>% 
  rename(Taxa = valor, Trimestre = trimestre) %>%
  d3plus(data = .,
         id = "id",
         type = "line",
         percent_var = "Taxa",
         locale = "pt_BR",
         number_text = "%",
         dictionary = dic_pib_grafico) %>% 
  d3plusX("Trimestre", grid = FALSE) %>% 
  d3plusY("Taxa") %>% 
  d3plusOrder("Trimestre", sort = "asc") %>% 
  d3plusTooltip(c("Trimestre", "Taxa")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id"), size = 60) %>%
  d3plusColor("id") %>%
  d3plusTitle(value = "Crescimento do PIB e setores",
              sub = "Taxa acumulada em 4 trimestres (CNT/IBGE)",
              font = list(size = 13, weight = 800))
```



### IBCR {.no-title}

```{r}
dic_ibc_grafico <- list(yoy = "Taxa",
                        date = "Período",
                        isolar = "Selecionar",
                        ocultar = "Esconder")

filtro_ibc <- ibc_grafico %>%
  group_by(ibcr) %>%
  filter(row_number() >= (n() - 12)) %>%
  pull(date)

d3plus(data = ibc_grafico,
       type = "bar",
       id = "ibcr",
       width = "100%",
       height = 500, 
       locale = "pt_BR",
       number_text = "%",
       percent_var = "yoy",
       noformat_number_var = "date",
       dictionary = dic_ibc_grafico) %>%
  d3plusX(value = "date", grid = FALSE,
          persist = list(position = TRUE)) %>%
  d3plusY(value = "yoy", grid = TRUE) %>% 
  d3plusAxes(ticks = FALSE,
             background = list(color = "#FFFFFF", stroke = list(width = 0))) %>%
  d3plusTime("date", solo = filtro_ibc) %>%
  d3plusTooltip("date") %>% 
  d3plusColor("ibcr") %>% 
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id"),
               size = 55) %>%
  d3plusTitle(value = "Índice de Atividade Econômica Regional do Banco Central (IBCR)",
              sub = "Taxa acumulada em 12 meses",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.ibcr}).draw();
            }
          })
  }')
```

Col {data-width=500 .tabset}
-----------------------------------------------------------------------

### Óticas do PIB (em %)

```{r}
pib_tabela %>%
  mutate(Margem = cell_spec(Margem, "html", color = ifelse(Margem > 0, "green", "red")),
         Interanual = cell_spec(Interanual, "html", color = ifelse(Interanual > 0, "green", "red")),
         `Acumulado no ano` = cell_spec(`Acumulado no ano`, "html", color = ifelse(`Acumulado no ano` > 0, "green", "red")),
         Anual = cell_spec(Anual, "html", color = ifelse(Anual > 0, "green", "red"))) %>%
  kable(escape = FALSE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = T,
                position = "left",
                font_size = 12,
                fixed_thead = list(enabled = T, background = "#cbcdd1")) %>%
  column_spec(1, bold = T) %>%
  row_spec(1, bold = T) %>%
  pack_rows(index = c(" " = 1, "Ótica da Oferta" = 3, "Ótica da Demanda" = 5)) %>%
  add_indent(1) %>%
  footnote(general_title = trim.pib,
           general = "\ 
           Margem: Taxa trimestre contra trimestre imediatamente anterior \
           Interanual: Taxa trimestral (em relação ao mesmo período do ano anterior) \
           Acumulado no ano: Taxa acumulada ao longo do ano (em relação ao mesmo período do ano anterior) \
           Anual: Taxa acumulada em quatro trimestres (em relação ao mesmo período do ano anterior) \
           \
           Fonte: IBGE")
```


### PMC

```{r}
dic_pmc <- list(taxa = "Taxa",
                periodo = "Período",
                indice = "Índice",
                isolar = "Selecionar",
                ocultar = "Esconder")

filtro_pmc <- pmc %>%
  group_by(indice) %>%
  filter(row_number() >= (n() - 18)) %>%
  pull(periodo)

d3plus(data = pmc,
       type = "bar",
       id = "indice",
       width = "100%",
       height = 500, 
       locale = "pt_BR",
       number_text = "%",
       percent_var = "taxa",
       noformat_number_var = "periodo",
       dictionary = dic_pmc) %>%
  d3plusX(value = "periodo", grid = FALSE,
          persist = list(position = TRUE)) %>%
  d3plusY(value = "taxa", grid = TRUE) %>% 
  d3plusAxes(ticks = FALSE,
             background = list(color = "#FFFFFF", stroke = list(width = 0))) %>%
  d3plusTime("periodo", solo = filtro_pmc) %>%
  d3plusTooltip("periodo") %>% 
  d3plusColor("indice") %>% 
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id"),
               size = 75) %>%
  d3plusTitle(value = "Pesquisa Mensal de Comércio (PMC/IBGE)",
              sub = "Variação mensal % (base: igual mês do ano anterior)",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.indice}).draw();
            }
          })
  }')
```

### PMS

```{r}
dic_pms <- list(taxa = "Taxa",
                periodo = "Período",
                indice = "Índice",
                isolar = "Selecionar",
                ocultar = "Esconder")

filtro_pms <- pms %>%
  group_by(indice) %>%
  filter(row_number() >= (n() - 36)) %>%
  pull(periodo)

d3plus(data = pms,
       type = "line",
       id = "indice",
       width = "100%",
       height = 500, 
       number_text = "%",
       locale = "pt_BR",
       percent_var = "taxa",
       dictionary = dic_pms) %>%
  d3plusX(value = "periodo", grid = FALSE) %>%
  d3plusY(value = "taxa", grid = TRUE) %>% 
  d3plusOrder("periodo", sort = "asc") %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = list(width = 0))) %>%
  d3plusTooltip(c("periodo", "taxa")) %>% 
  d3plusTime("periodo", solo = filtro_pms) %>%
  d3plusColor("indice") %>% 
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "indice"), size = 75) %>%
  d3plusTitle(value = "Pesquisa Mensal de Serviços (PMS/IBGE)",
              sub = "Variação mensal % (base: igual mês do ano anterior)",
              font = list(size = 13, weight = 800))
```

### PIM-PF

```{r}
dic_pim <- list(taxa = "Taxa",
                periodo = "Período",
                atividade = "Atividade",
                isolar = "Selecionar",
                ocultar = "Esconder")

filtro_pim <- pim %>%
  group_by(atividade) %>%
  filter(row_number() >= (n() - 18)) %>%
  pull(periodo)

d3plus(data = pim,
       type = "bar",
       id = "atividade",
       width = "100%",
       height = 500, 
       locale = "pt_BR",
       number_text = "%",
       percent_var = "taxa",
       noformat_number_var = "periodo",
       dictionary = dic_pim) %>%
  d3plusX(value = "periodo", grid = FALSE,
          persist = list(position = TRUE)) %>%
  d3plusY(value = "taxa", grid = TRUE) %>% 
  d3plusAxes(ticks = FALSE,
             background = list(color = "#FFFFFF", stroke = list(width = 0))) %>%
  d3plusTime("periodo", solo = filtro_pim) %>%
  d3plusTooltip("periodo") %>% 
  d3plusColor("atividade") %>% 
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "atividade"),
               size = 75) %>%
  d3plusTitle(value = "Pesquisa Industrial Mensal - Produção Física (PIM-PF/IBGE)",
              sub = "Variação mensal % (base: igual mês do ano anterior)",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.atividade}).draw();
            }
          })
  }')
```



Inflação {data-navmenu="Explorar" data-icon="fa-hand-holding-usd"}
=====================================

Col {data-width=350}
-----------------------------------------------------------------------


### Inflação em 12 meses (IPCA)

```{r}
ipca_12m %>% 
  mutate(valor = paste0(valor, "%")) %>% 
  pull(valor) %>% 
  valueBox(value = ., icon = 'fa-chart-bar', color =  ifelse(. > meta_inf$valor, "warning", "success"))
```


### Meta de inflação para `r meta_inf$date` (CMN)

```{r}
meta_inf %>% 
  mutate(valor = paste0(valor, "%")) %>% 
  pull(valor) %>% 
  valueBox(value = ., icon = 'fa-bullseye')
```


### Índice de Difusão {.no-title}

```{r}
dic_ipca_difusao <- list(date = "Periodo",
                         value = "Índice",
                         isolar = "Selecionar",
                         ocultar = "Esconder")

filtro_ipca_difusao <- ipca_difusao %>%
  filter(row_number() >= (n() - 72)) %>%
  pull(date)
  

d3plus(data = ipca_difusao,
       type = "line",
       id = "id",
       width = "100%",
       height = 500, 
       number_text = "%",
       locale = "pt_BR",
       percent_var = "value",
       dictionary = dic_ipca_difusao) %>%
  d3plusX(value = "date", grid = FALSE) %>%
  d3plusY(value = "value", grid = TRUE) %>% 
  d3plusOrder("date", sort = "asc") %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = list(width = 0))) %>%
  d3plusTooltip(c("date", "value")) %>% 
  d3plusTime("date", solo = filtro_ipca_difusao) %>%
  d3plusColor("id") %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id"), size = 75) %>%
  d3plusTitle(value = "Índice de Difusão - IPCA (BCB)",
              font = list(size = 13, weight = 800))
```

Col {data-width=650}
-----------------------------------------------------------------------


### Evolução da Inflação {.no-title}

```{r, fig.height=3}
dic_ipca_grafico <- list(periodo = "Período",
                         valor = "Taxa",
                         isolar = "Selecionar",
                         ocultar = "Esconder")

filtro_ipca <- ipca_grafico %>%
  group_by(taxa) %>%
  filter(row_number() >= (n() - 72)) %>%
  select(periodo) %>%
  pull(periodo)

d3plus(data = ipca_grafico,
       type = "line",
       id = "taxa",
       width = "100%",
       height = 500, 
       number_text = "%",
       locale = "pt_BR",
       percent_var = "valor",
       dictionary = dic_ipca_grafico) %>%
  d3plusX(value = "periodo", grid = FALSE) %>%
  d3plusY(value = "valor", grid = TRUE) %>% 
  d3plusOrder("periodo", sort = "asc") %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = list(width = 0))) %>%
  d3plusTooltip(c("periodo", "valor")) %>% 
  d3plusTime("periodo", solo = filtro_ipca) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "taxa"), size = 40) %>%
  d3plusTitle(value = "Inflação medida pelo IPCA (IBGE)",
              sub = "Variação mensal e acumulada em 12 meses (%)",
              font = list(size = 13, weight = 800))
```


### Inflação por Região Metropolitana {.no-title}

```{r}
filtro_ipca_regiao <- dados_ipca_regiao %>%
  filter(regiao == tail(regiao, 1) & row_number() >= (n() - 12)) %>%
  select(periodo) %>%
  pull(periodo)

d3plus(data = dados_ipca_regiao,
       type = "bar",
       id = "regiao",
       width = "100%",
       height = 500, 
       number_text = "%",
       locale = "pt_BR",
       noformat_number_var = "periodo",
       percent_var = "valor",
       dictionary = dic_ipca_regiao) %>%
  d3plusX(value = "periodo", grid = FALSE) %>%
  d3plusY(value = "valor", grid = TRUE) %>% 
  d3plusOrder("periodo", sort = "asc") %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = list(width = 0))) %>%
  d3plusTooltip(c("periodo", "valor")) %>% 
  d3plusColor("regiao") %>% 
  d3plusTime("periodo", solo = filtro_ipca_regiao) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "regiao"), size = 50) %>%
  d3plusTitle(value = "IPCA por região (IBGE)",
              sub = "Variação acumulada no ano (%)",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.regiao}).draw();
            }
          })
  }')
```


Col {data-width=400 .tabset}
-----------------------------------------------------------------------

### IPCA por grupos

```{r}
ipca_grupos_tabela %>%
  mutate(`Mensal` = cell_spec(`Mensal`,
                              format = "html",
                              color = ifelse(`Mensal` > 0, "green", "red")),
         `Acumulada no Ano` = cell_spec(`Acumulada no Ano`,
                                        format = "html",
                                        color = ifelse(`Acumulada no Ano` > 0, "green", "red"))) %>%
  kable(escape = FALSE,
        align = c('l', 'r', 'r')) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = T,
                position = "left",
                font_size = 12,
                fixed_thead = list(enabled = T, background = "#cbcdd1")) %>%
  column_spec(1, bold = T) %>%
  column_spec(2, width = "3em") %>%
  column_spec(3, width = "10em") %>%
  add_indent(2:10) %>%
  footnote(general_title = ipca.grupos,
           general = "\ 
           Mensal:  Variação mensal (%) \
           Acumulada no ano: Variação acumulada no ano (%) \
           \
           Fonte: IBGE")
```


### Núcleos

```{r}
dic_ipca_nucleos <- list(periodo = "Periodo",
                         valor = "Taxa",
                         nucleo = "Núcleo",
                         isolar = "Selecionar",
                         ocultar = "Esconder")

filtro_ipca_nucleos <- ipca_nucleos %>%
  filter(nucleo == first(nucleo)) %>%
  slice(tail(row_number(), 36)) %>%
  pull(date)

d3plus(data = ipca_nucleos,
       type = "line",
       id = "nucleo",
       number_text = "%",
       width = "100%",
       height = 500, 
       locale = "pt_BR",
       noformat_number_var = "date",
       percent_var = "valor",
       dictionary = dic_ipca_nucleos) %>%
  d3plusX(value = "date", grid = FALSE) %>%
  d3plusY(value = "valor", grid = TRUE) %>% 
  d3plusOrder("date", sort = "asc") %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = list(width = 0))) %>%
  d3plusTooltip(c("date", "valor")) %>% 
  d3plusColor("nucleo") %>% 
  d3plusTime("date", solo = filtro_ipca_nucleos) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "nucleo"), size = 60) %>%
  d3plusTitle(value = "Núcleos do IPCA (BCB)",
              sub = "Var. % mensal",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.nucleo}).draw();
            }
          })
  }')
```

### IGP

```{r}
dic_igp_grafico <- list(periodo = "Periodo",
                        valor = "Taxa",
                        igp = "Índice",
                        isolar = "Selecionar",
                        ocultar = "Esconder")

filtro_igp <- igp_grafico %>%
  filter(igp == first(igp)) %>%
  slice(tail(row_number(), 36)) %>%
  pull(date)

d3plus(data = igp_grafico,
       type = "line",
       id = "igp",
       number_text = "%",
       width = "100%",
       height = 500, 
       locale = "pt_BR",
       noformat_number_var = "date",
       percent_var = "valor",
       dictionary = dic_igp_grafico) %>%
  d3plusX(value = "date", grid = FALSE) %>%
  d3plusY(value = "valor", grid = TRUE) %>% 
  d3plusOrder("date", sort = "asc") %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = list(width = 0))) %>%
  d3plusTooltip(c("date", "valor")) %>% 
  d3plusColor("igp") %>% 
  d3plusTime("date", solo = filtro_igp) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "igp"), size = 60) %>%
  d3plusTitle(value = "Índice Geral de Preços - IGP (FGV)",
              sub = "Var. % mensal",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.igp}).draw();
            }
          })
  }')
```


Mercado de Trabalho {data-navmenu="Explorar" data-icon="fa-users"}
=====================================
Esta seção é baseada na contribuição do [Paulo Felipe Alencar](https://bit.ly/3iXHNAY) para utilização dos microdados da PNADC/IBGE.


Column {data-width=400}
-----------------------------------------------------------------------

### Pessoas Ocupadas `r paste0("(em ", dados_pnadc$Ano[1], "-T", dados_pnadc$Trimestre[1], ")")`

```{r}
totais %>% 
  mutate(pessoas_ocupadas = paste0(pessoas_ocupadas, " milhões")) %>%
  pull(pessoas_ocupadas) %>% 
  valueBox(value = ., icon = 'fa-users')
```


### Pessoas Desocupadas `r paste0("(em ", dados_pnadc$Ano[1], "-T", dados_pnadc$Trimestre[1], ")")`

```{r}
totais %>% 
  mutate(pessoas_desocupadas = paste0(pessoas_desocupadas, " milhões")) %>%
  pull(pessoas_desocupadas) %>%
  valueBox(value = ., icon = 'fa-user-times')
```


### Perfil de Ocupação {.no-title}

```{r}
dic_perfil_ocupacao <- list(trimestre = "Trimestre",
                            valor = "Pessoas Ocupadas",
                            ocupacao = "Ocupação",
                            isolar = "Selecionar",
                            ocultar = "Esconder",
                            `participação` = "Em relação ao total de PO")

d3plus(data = perfil_ocupacao,
       type = "tree_map",
       id = "ocupacao",
       width = "100%",
       height = 500,
       number_text = num_txt_ocupacao,
       dictionary = dic_perfil_ocupacao,
       locale = "pt_BR",) %>% 
  d3plusSize(value = "valor") %>% 
  d3plusTooltip(c("trimestre")) %>% 
  d3plusTitle(value = "Pessoas Ocupadas por posição de ocupação",
              font = list(size = 13, weight = 800)) %>%
  d3plusLabels(value = TRUE, valign = "top")

```


Column {data-width=525}
-----------------------------------------------------------------------

### Evolução da Taxa de Desemprego {.no-title}

```{r}
dic_desemprego <- list(
  tx_desemprego = "Taxa de Desemprego",
  pessoas_ocupadas = "Pessoas Ocupadas",
  pessoas_desocupadas = "Pessoas Desocupadas",
  trimestre = "Trimestre",
  isolar = "Isolar",
  ocultar = "Ocultar")

d3plus(data = desemprego,
         id = "id",
         type = "line",
         percent_var = "tx_desemprego",
         locale = "pt_BR",
         number_text = num_txt_desemprego_map,
         dictionary = dic_desemprego) %>% 
  d3plusX("trimestre", grid = FALSE) %>% 
  d3plusY("tx_desemprego") %>% 
  d3plusOrder("trimestre", sort = "asc") %>% 
  d3plusTooltip(c("trimestre", "pessoas_ocupadas", "pessoas_desocupadas")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>%
  d3plusTitle(value = "Evolução da Taxa de Desemprego (%)",
              font = list(size = 13, weight = 800))
```


### Taxa de Desemprego por Gênero e Cor/Raça {.no-title}

```{r}
d3plus(data = desemprego_gencor,
         type = "bar",
         id = "v2007",
         dictionary = dic_desemprego,
         locale = "pt_BR",
         percent_var = "tx_desemprego",
         number_text = num_txt_desemprego_map,
         d3plus_number_format = TRUE) %>% 
  d3plusX(value = "v2010", label = "Cor/Raça", grid = FALSE) %>% 
  d3plusY("tx_desemprego", label = "Taxa de Desemprego") %>% 
  d3plusOrder(value = "v2010", sort = "asc") %>% 
  d3plusLegend(value = TRUE, data = FALSE, title = "Gênero", align = "center") %>% 
  d3plusTooltip(value = c("trimestre", "pessoas_ocupadas", "pessoas_desocupadas")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusAttrs(genero_attr) %>% 
  d3plusColor("cor") %>% 
  d3plusIcon("icon", style = "knockout") %>%
  d3plusTitle(value = "Taxa de Desemprego por Gênero e Cor/Raça (%)",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.v2007}).draw();
            }
          })
  }')
```


Col {data-width=450 .tabset}
-----------------------------------------------------------------------

### Desemprego por UF

```{r}
d3plus(data = desemprego_map,
         type = "geo_map",
         locale = "pt_BR",
         percent_var = "tx_desemprego",
         id = "uf_id",
         currency = "US$",
         number_text = num_txt_desemprego_map,
         dictionary = dicionario_desemprego_map) %>% 
  d3plusCoords(value = "https://gist.githubusercontent.com/schoulten/93ed632d8e8b9be7a579f5cb20b20c04/raw/ae9f2c8338d1a9eddf95e03b62bfd7541ca5f980/br-states.json",
               projection = "equirectangular") %>% 
  d3plusColor(value = "tx_desemprego", heatmap = RColorBrewer::brewer.pal(n = 6, name = "YlOrBr")) %>% 
  d3plusText("uf") %>% 
  d3plusTooltip(value = c("trimestre", "pessoas_ocupadas", "pessoas_desocupadas", "tx_desemprego")) %>%
  d3plusTitle(value = "Taxa de Desemprego por Estados (%)",
              font = list(size = 13, weight = 800))
```


### Nível
```{r}
dic_nivel_ocupacao <- list(trimestre = "Trimestre",
                           valor = "Taxa",
                           sexo = "Sexo",
                           isolar = "Selecionar",
                           ocultar = "Esconder")

d3plus(data = nivel_ocupacao %>%
                group_by(sexo) %>%
                filter(row_number() >= (n() - 24)),
       type = "line",
       id = "sexo",
       dictionary = dic_nivel_ocupacao,
       locale = "pt_BR",
       percent_var = "valor",
       number_text = "%",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "trimestre", label = "Período", grid = FALSE) %>% 
  d3plusY("valor", label = "Taxa") %>% 
  d3plusOrder(value = "trimestre", sort = "asc") %>% 
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "sexo"), size = 75) %>% 
  d3plusTooltip(value = c("trimestre", "valor")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusColor("sexo") %>% 
  d3plusTitle(value = "Nível da Ocupação por Gênero e Total (%)",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.sexo}).draw();
            }
          })
  }')
```





### Participação
```{r}
dic_taxa_participacao <- list(trimestre = "Trimestre",
                              valor = "Taxa",
                              sexo = "Sexo",
                              isolar = "Selecionar",
                              ocultar = "Esconder")

d3plus(data = taxa_participacao %>%
                group_by(sexo) %>%
                filter(row_number() >= (n() - 24)),
       type = "line",
       id = "sexo",
       dictionary = dic_taxa_participacao,
       locale = "pt_BR",
       percent_var = "valor",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "trimestre", label = "Período", grid = FALSE) %>% 
  d3plusY("valor", label = "Taxa") %>% 
  d3plusOrder(value = "trimestre", sort = "asc") %>% 
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "igp"), size = 75) %>% 
  d3plusTooltip(value = c("trimestre", "valor")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusColor("sexo") %>% 
  d3plusTitle(value = "Taxa de Participação por Gênero e Total (%)",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.sexo}).draw();
            }
          })
  }')
```


### Rendimento
```{r}
dic_rendimento <- list(trimestre = "Trimestre",
                     idade = "Idade",
                     valor = "Rendimento",
                     isolar = "Selecionar",
                     ocultar = "Esconder")

d3plus(data = rendimento %>%
                group_by(idade) %>%
                filter(row_number() >= (n() - 4)),
         type = "bar",
         id = "idade",
         dictionary = dic_rendimento,
         locale = "pt_BR",
         currency = "R$",
         number_text = num_txt_desemprego_map,
         currency_var = "valor",
         d3plus_number_format = TRUE) %>% 
  d3plusX(value = "trimestre", label = "Período", grid = FALSE) %>% 
  d3plusY("valor", label = "Rendimento") %>% 
  d3plusOrder(value = "trimestre", sort = "asc") %>% 
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id", sort = "asc"), size = 55) %>% 
  d3plusTooltip(value = c("trimestre", "valor")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusColor("id") %>%
  d3plusTitle(value = "Rendimento por Grupos de Idade (R$)",
              sub = "Valor médio real de todos os trabalhos, efetivamente recebido",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.idade}).draw();
            }
          })
  }')


```


### Gini
```{r}
dic_gini <- list(uf = "UF",
                 trimestre = "Trimestre",
                 VD4020 = "Índice de Gini",
                 isolar = "Selecionar",
                 ocultar = "Esconder")

d3plus(data = gini,
       type = "bar",
       id = "uf",
       dictionary = dic_gini,
       locale = "pt_BR",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "uf_id", label = "", grid = FALSE) %>% 
  d3plusY("VD4020", grid = TRUE) %>% 
  d3plusOrder(value = "VD4020", sort = "asc") %>% 
  d3plusTooltip(value = c("VD4020", "trimestre")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusColor("id") %>%
  d3plusTitle(value = "Índice de Gini: Ranking Estadual",
              sub = "Cálculo através da renda efetiva, zero = igualdade, 1 = desigualdade",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.uf_id}).draw();
            }
          })
  }')
```






Política Fiscal {data-navmenu="Explorar" data-icon="fa-gavel"}
=====================================

Column {data-width=450}
-----------------------------------------------------------------------


### Resultado Primário {.no-title}

```{r}
dic_res_primario <- list(periodo = "Mês",
                         primario = "Valor",
                         isolar = "Selecionar",
                         ocultar = "Esconder")

filtro_res_primario <- res_primario %>%
  slice_tail(n = 120) %>%
  pull(periodo)
  
d3plus(data = res_primario,
         type = "line",
         id = "id",
         dictionary = dic_res_primario,
         locale = "pt_BR",
         percent_var = "primario",
         number_text = "%",
         d3plus_number_format = TRUE) %>% 
  d3plusX(value = "periodo", label = "Período", grid = FALSE) %>% 
  d3plusY("primario", label = "% PIB") %>% 
  d3plusOrder(value = "periodo", sort = "asc") %>% 
  d3plusTime("periodo", solo = filtro_res_primario) %>%
  d3plusTooltip(value = c("periodo", "primario")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Resultado Primário do Governo Central (% PIB)",
              sub = "Valores acumulados em 12 meses e deflacionados pelo IPCA (STN e IBGE)",
              font = list(size = 13, weight = 800))
```


### Receitas e Despesas do Governo  {.no-title}

```{r}
dic_receita_desp <- list(periodo = "Mês",
                     value = "Valor",
                     isolar = "Selecionar",
                     ocultar = "Esconder")

filtro_receita_desp <- receita_desp %>%
  filter(row_number() >= (n() - 240), fluxo == first(fluxo)) %>%
  pull(periodo)

d3plus(data = receita_desp,
         type = "line",
         id = "fluxo",
         dictionary = dic_receita_desp,
         locale = "pt_BR",
         percent_var = "value",
         number_text = "%",
         d3plus_number_format = TRUE) %>% 
  d3plusX(value = "periodo", label = "Período", grid = FALSE) %>% 
  d3plusY("value", label = "% PIB") %>% 
  d3plusOrder(value = "periodo", sort = "asc") %>% 
  d3plusTime("periodo", solo = filtro_receita_desp) %>%
  d3plusTooltip(value = c("periodo", "valor")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Receita Líquida e Despesa Total do Governo Central (% PIB)",
              sub = "Valores acumulados em 12 meses e deflacionados pelo IPCA (STN e IBGE)",
              font = list(size = 13, weight = 800))

```

Column {data-width=450}
-----------------------------------------------------------------------

### Composição das Receitas e Despesas {.no-title}

```{r}
d3plus(data = comp_rec_desp,
       type = "tree_map",
       id = c("categoria_1", "categoria_2", "categoria_3"),
       width = "100%",
       height = 500,
       number_text = c("Bilhões", "Trilhão", "Trilhões"),
       dictionary = dic_comp_rec_desp,
       locale = "pt_BR") %>% 
  d3plusSize(value = "valor") %>% 
  d3plusLegend(value = FALSE, order = list(sort = "desc", value = "size")) %>% 
  d3plusColor("categoria_1") %>% 
  d3plusDepth(0) %>% 
  d3plusTooltip(c("periodo", "valor")) %>%
  d3plusTitle(value = "Desagregação de Receitas e Despesas do Governo Central",
              sub = "Valores acumulados em 12 meses e deflacionados pelo IPCA (STN e IBGE)",
              font = list(size = 13, weight = 800)) %>%
  d3plusLabels(valign = "top")
```


### Evolução da Conta Única do Tesouro {.no-title}

```{r}
dic_conta_unica <- list(periodo = "Mês",
                     disponibilidade = "Saldo",
                     isolar = "Selecionar",
                     ocultar = "Esconder")

num_txt_conta_unica <- c("Bilhões", "Trilhão", "Trilhões")

filtro_conta_unica <- conta_unica %>%
  slice_tail(n = 96) %>%
  pull(periodo)

d3plus(data = conta_unica,
         type = "area",
         id = "id",
         dictionary = dic_conta_unica,
         locale = "pt_BR",
         currency = "R$",
         currency_var = "disponibilidade",
         number_text = num_txt_conta_unica,
         d3plus_number_format = TRUE) %>% 
  d3plusX(value = "periodo", label = "Período", grid = FALSE) %>% 
  d3plusY("disponibilidade", label = "") %>% 
  d3plusOrder(value = "periodo", sort = "asc") %>% 
  d3plusTime("periodo", solo = filtro_conta_unica) %>%
  d3plusTooltip(value = c("periodo", "disponibilidade")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Saldo da Conta Única do Tesouro Nacional",
              sub = "Valores em R$ Trilhões deflacionados pelo IPCA (BCB e IBGE)",
              font = list(size = 13, weight = 800))

```


Column {data-width=450 .tabset}
-----------------------------------------------------------------------

### Risco da Dívida

```{r}
risco %>%
  kable(escape = FALSE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = T,
                position = "left",
                font_size = 12,
                fixed_thead = list(enabled = T, background = "#cbcdd1")) %>%
  row_spec(1:nrow(risco), color = "black") %>%
  scroll_box() %>%
  footnote(general = "Tesouro Nacional", general_title = "Fonte: ")
```


### Estoque da Dívida

```{r}
dic_estoque_div <- list(periodo = "Mês",
                        valor_real = "Valor",
                        isolar = "Selecionar",
                        ocultar = "Esconder")

num_txt_estoque_div <- c("Trilhões", "Trilhões")

filtro_estoque_div <- estoque_div %>%
  slice_tail(n = 96) %>%
  pull(periodo)

d3plus(data = estoque_div,
         type = "area",
         id = "id",
         dictionary = dic_estoque_div,
         locale = "pt_BR",
         currency = "R$",
         currency_var = "valor",
         number_text = num_txt_estoque_div,
         d3plus_number_format = TRUE) %>% 
  d3plusX(value = "periodo", label = "Período", grid = FALSE) %>% 
  d3plusY("valor", label = "") %>% 
  d3plusOrder(value = "periodo", sort = "asc") %>% 
  d3plusTime("periodo", solo = filtro_estoque_div) %>%
  d3plusTooltip(value = c("periodo", "valor")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Estoque da Dívida Pública Federal",
              sub = "Valores em R$ Trilhões deflacionados pelo IPCA (BCB e IBGE)",
              font = list(size = 13, weight = 800)) 
```



### Carteira de Títulos Públicos

```{r}
dic_titulos_dpmfi <- list(mes_ano = "Mês",
                          value = "R$",
                          isolar = "Selecionar",
                          ocultar = "Econder",
                          `participação` = "% da Carteira")

d3plus(data = titulos_dpmfi %>%
         filter(periodo == max(periodo)),
       type = "tree_map",
       id = "id",
       dictionary = dic_titulos_dpmfi,
       locale = "pt_BR",
       number_text = c("Bilhões", "Trilhão", "Trilhões"),
       d3plus_number_format = TRUE) %>% 
  d3plusSize(value = "value") %>% 
  d3plusLegend(value = FALSE, order = list(sort = "desc", value = "size")) %>% 
  d3plusColor("id") %>% 
  d3plusDepth(0) %>% 
  d3plusTooltip(value = c("mes_ano", "value")) %>% 
  d3plusTitle(value = "Composição da carteira de Títulos Públicos do Tesouro Nacional",
              sub = "Valores em R$ Trilhões (BCB)",
              font = list(size = 13, weight = 800)) %>%
  d3plusLabels(valign = "top")
```



Política Monetária {data-navmenu="Explorar" data-icon="fa-percentage"}
=====================================

Column {data-width=325}
-----------------------------------------------------------------------

### Meta da Taxa de Juros SELIC (% a.a.)

```{r}
selic %>% 
  valueBox(value = ., icon = 'fa-percentage')
```


### Meta de Inflação para `r meta_inf$date` (CMN)

```{r}
meta_inf %>% 
  mutate(valor = paste0(valor, "%")) %>% 
  pull(valor) %>% 
  valueBox(value = ., icon = 'fa-bullseye')
```


### Expectativas de Inflação {.no-title}

```{r}
dic_inf_expec <- list(mes_ano = "Período",
                      mean = "Taxa",
                      isolar = "Selecionar",
                      ocultar = "Esconder")

filtro_inf_expec <- inf_expec %>%
  arrange(date) %>%
  slice_tail(n = 48) %>%
  pull(date)
  
d3plus(data = inf_expec,
       type = "area",
       id = "indic",
       dictionary = dic_inf_expec,
       locale = "pt_BR",
       percent_var = "mean",
       number_text = "%",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "date", label = "Período", grid = FALSE) %>% 
  d3plusY("mean", label = "Taxa") %>% 
  d3plusOrder(value = "date", sort = "asc") %>% 
  d3plusTime("date", solo = filtro_inf_expec) %>%
  d3plusTooltip(value = c("mes_ano", "mean")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Expectativas de Inflação 12 meses à frente",
              sub = "Boletim Focus do último dia do mês, média suavizada (BCB)",
              font = list(size = 13, weight = 800))
```



Column {data-width=500}
-----------------------------------------------------------------------

### Evolução das Taxas de Juros {.no-title}

```{r}

dic_juros <- list(mes_ano = "Período",
                  value = "Taxa",
                  isolar = "Selecionar",
                  ocultar = "Esconder")

filtro_juros <- juros %>%
  arrange(date) %>%
  filter(variavel == first(variavel)) %>%
  slice(tail(row_number(), 12)) %>%
  pull(date)

d3plus(data = juros,
       type = "bar",
       id = "variavel",
       dictionary = dic_juros,
       locale = "pt_BR",
       percent_var = "value",
       number_text = "%",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "date", label = "Período", grid = FALSE) %>% 
  d3plusY("value") %>% 
  d3plusOrder(value = "date", sort = "asc") %>% 
  d3plusTime("date", solo = filtro_juros) %>%
  d3plusTooltip(value = c("mes_ano", "value")) %>% 
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "variavel", sort = "asc"), size = 40) %>%
  d3plusColor("variavel") %>%
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Evolução das Taxas de Juros",
              sub = "Taxas nominais, fim de período, em % a.a. (BCB)",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.variavel}).draw();
            }
          })
  }')

```

### Juros Real ex-ante e ex-post {.no-title}

```{r}
filtro_juros_real <- juros_real %>%
  filter(id == first(id)) %>%
  slice(tail(row_number(), 72)) %>%
  pull(data)

d3plus(data = juros_real,
       type = "line",
       id = "id",
       dictionary = dic_juros_real,
       locale = "pt_BR",
       percent_var = "valor",
       number_text = "%",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "data", label = "Período", grid = FALSE) %>% 
  d3plusY("valor", label = "Taxa") %>% 
  d3plusOrder(value = "data", sort = "asc") %>% 
  d3plusTime("data", solo = filtro_juros_real) %>%
  d3plusTooltip(value = c("data", "valor")) %>% 
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id", sort = "asc"), size = 45) %>%
  d3plusColor("id") %>%
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Taxa de Juros Real ex-ante e ex-post",
              sub = "Taxa em % a.a. (B3, BCB e IBGE)",
              font = list(size = 13, weight = 800)) %>%
  onRender('function(el, x, data){
           var viz = this.viz;
           viz.mouse({"click": function(d){
              viz.id({"solo": d.id}).draw();
            }
          })
  }')
```



Column {data-width=500 .tabset}
-----------------------------------------------------------------------

### Mercado Cambial

```{r}
moedas %>%
  mutate(`Mensal (%)` = cell_spec(`Mensal (%)`, "html", color = ifelse(`Mensal (%)` > 0, "green", "red")),
         `Trimestral (%)` = cell_spec(`Trimestral (%)`, "html", color = ifelse(`Trimestral (%)` > 0, "green", "red")),
         `Interanual (%)` = cell_spec(`Interanual (%)`, "html", color = ifelse(`Interanual (%)` > 0, "green", "red")),
         `12 meses (%)` = cell_spec(`12 meses (%)`, "html", color = ifelse(`12 meses (%)` > 0, "green", "red"))) %>%
  kable(escape = FALSE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = T,
                position = "left",
                font_size = 12,
                fixed_thead = list(enabled = T, background = "#cbcdd1"),
                protect_latex = TRUE) %>%
  column_spec(1:2, bold = T) %>%
  footnote(general_title = moedas_footnote, 
           general = "\ 
                      Moedas cotadas em Real (u.m.c./R$) \
                      Mensal (%): variação do mês t contra mês imediatamente anterior (t-1) \
                      Trimestral (%): variação do acumulado  no trimestre contra mesmo trimestre do ano anterior \
                      Interanual (%): variação do mês t contra mesmo mês do ano anterior (t-12) \
                      12 meses (%): variação do acumulado em 12 meses contra mesmo período do ano anterior \
                       \
                      Fonte: BCB")
```

### Expectativas de Juros

```{r}
dic_selic_expec <- list(mes_ano = "Período",
                        mean = "Valor",
                        indic_detail = "Projeção para",
                        reference_year = "Ano de referência",
                        isolar = "Selecionar",
                        ocultar = "Esconder")

filtro_selic_expec <- selic_expec %>%
  arrange(date) %>%
  slice_tail(n = 48) %>%
  pull(date)

d3plus(data = selic_expec,
       type = "area",
       id = "indic",
       dictionary = dic_selic_expec,
       locale = "pt_BR",
       percent_var = "mean",
       number_text = "%",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "date", label = "Data", grid = FALSE) %>% 
  d3plusY("mean", label = "Taxa") %>% 
  d3plusOrder(value = "date", sort = "asc") %>% 
  d3plusTime("date", solo = filtro_selic_expec) %>%
  d3plusTooltip(value = c("indic_detail", "reference_year", "mes_ano", "mean")) %>% 
  d3plusLegend(value = FALSE, data = FALSE,
               order = list(value = "indic", sort = "asc"), size = 45) %>%
  d3plusColor("indic") %>%
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Expectativas da Taxa SELIC",
              sub = "Boletim Focus do último dia do mês, valor médio (BCB)",
              font = list(size = 13, weight = 800))
```

### ETTJ

```{r}
dic_ettj <- list(data_consulta = "Data consulta",
                 data_dmy = "Data do vértice",
                 valor = "Taxa",
                 dias_uteis = "Nº de dias úteis",
                 isolar = "Selecionar",
                 ocultar = "Esconder")

d3plus(data = ettj,
       type = "line",
       id = "id",
       dictionary = dic_ettj,
       locale = "pt_BR",
       percent_var = "valor",
       number_text = "%",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "data_ref", label = "Data/Vértice", grid = FALSE) %>% 
  d3plusY("valor", label = "Taxa") %>% 
  d3plusOrder(value = "data_ref", sort = "asc") %>% 
  d3plusTooltip(value = c("data_consulta", "data_dmy", "dias_uteis", "valor")) %>% 
  d3plusLegend(value = FALSE, data = FALSE,
               order = list(value = "id", sort = "asc"), size = 45) %>%
  d3plusColor("id") %>%
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Estrutura a Termo da Taxa de Juros (ETTJ)",
              sub = "Taxa (%a.a./252, dados da ANBIMA)",
              font = list(size = 13, weight = 800))
```

### Ibovespa

```{r}
dic_ibov <- list(mes_ano = "Período",
                 pontos = "Pontos",
                 isolar = "Selecionar",
                 ocultar = "Esconder")

filtro_ibov <- ibov %>%
  arrange(periodo) %>%
  slice_tail(n = 24) %>%
  pull(periodo)

d3plus(data = ibov %>%
         mutate(pontos = pontos/1000),
       type = "area",
       id = "id",
       dictionary = dic_ibov,
       locale = "pt_BR",
       noformat_number_var = "pontos",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "periodo", label = "Pregão", grid = FALSE) %>% 
  d3plusY("pontos", label = "Mil Pontos") %>% 
  d3plusOrder(value = "periodo", sort = "asc") %>% 
  d3plusTime("periodo", solo = filtro_ibov) %>%
  d3plusTooltip(value = c("mes_ano", "pontos")) %>% 
  d3plusLegend(value = FALSE, data = FALSE,
               order = list(value = "id", sort = "asc"), size = 45) %>%
  d3plusColor("id") %>%
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Índice Bovespa",
              sub = "Pontos do fechamento do pregão, último dia do mês (B3)",
              font = list(size = 13, weight = 800))
```

### Risco-País

```{r}
dic_embi <- list(mes_ano = "Período",
                 valor = "Índice",
                 isolar = "Selecionar",
                 ocultar = "Esconder")

filtro_embi <- embi %>%
  arrange(data) %>%
  slice_tail(n = 48) %>%
  pull(data)

d3plus(data = embi,
       type = "line",
       id = "id",
       dictionary = dic_embi,
       locale = "pt_BR",
       noformat_number_var = "valor",
       d3plus_number_format = TRUE) %>% 
  d3plusX(value = "data", label = "Período", grid = FALSE) %>% 
  d3plusY("valor", label = "Índice") %>% 
  d3plusOrder(value = "data", sort = "asc") %>% 
  d3plusTime("data", solo = filtro_embi) %>%
  d3plusTooltip(value = c("mes_ano", "valor")) %>% 
  d3plusLegend(value = FALSE, data = FALSE,
               order = list(value = "id", sort = "asc"), size = 45) %>%
  d3plusColor("id") %>%
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>% 
  d3plusTitle(value = "Risco-Brasil medido pelo EMBI+",
              sub = "Índice do último dia do mês (JP Morgan)",
              font = list(size = 13, weight = 800))
```



Economia Internacional {data-navmenu="Explorar" data-icon="fa-globe-americas"}
=====================================

Column
-----------------------------------------------------------------------

### Evolução do PIB por países {.no-title}

```{r}
d3plus(data = pib_ocde %>%
                group_by(codigo) %>%
                slice_tail(n = 8),
       id = "codigo",
       type = "line",
       percent_var = "valor",
       locale = "pt_BR",
       number_text = "%",
       dictionary = dic_pib_ocde) %>% 
  d3plusX("periodo", grid = FALSE) %>% 
  d3plusY("valor") %>% 
  d3plusOrder("periodo", sort = "asc") %>% 
  d3plusTooltip(c("pais", "periodo", "valor", "observacao")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id"), size = 40) %>%
  d3plusColor("codigo") %>%
  d3plusTitle(value = "PIB: crescimento por países",
              sub = "Taxa de crescimento comparada com mesmo trimestre do ano anterior, sazonalmente ajustada (OCDE)",
              font = list(size = 13, weight = 800))
```


### Comportamento da Inflação por países {.no-title}

```{r}
dic_inflacao_ocde <- list(
  valor = "Taxa",
  periodo = "Mês",
  observacao = "Observação",
  pais = "País",
  isolar = "Selecionar",
  ocultar = "Esconder")

filtro_inflacao_ocde <- inflacao_ocde %>%
  arrange(periodo) %>%
  filter(codigo == first(codigo)) %>%
  slice(tail(row_number(), 72)) %>%
  pull(periodo)

d3plus(data = inflacao_ocde %>%
         filter(!codigo %in% c("ARG", "TUR")), ## atualizável
       id = "codigo",
       type = "line",
       percent_var = "valor",
       locale = "pt_BR",
       number_text = "%",
       dictionary = dic_inflacao_ocde,
       noformat_number_var = "valor") %>% 
  d3plusX("periodo", grid = FALSE) %>% 
  d3plusY("valor") %>% 
  d3plusOrder("periodo", sort = "asc") %>% 
  d3plusTooltip(c("pais", "periodo", "valor", "observacao")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id"), size = 40) %>%
  d3plusColor("codigo") %>%
  d3plusTime("periodo", solo = filtro_inflacao_ocde) %>%
  d3plusTitle(value = "Inflação: comportamento por países",
              sub = "Taxa de crescimento em relação ao mesmo período do ano anterior (OCDE)",
              font = list(size = 13, weight = 800))
```

Column
-----------------------------------------------------------------------

### Taxa de Desemprego por países {.no-title}

```{r}
dic_desemprego_ocde <- list(
  valor = "Taxa",
  periodo = "Mês",
  observacao = "Observação",
  pais = "País",
  isolar = "Selecionar",
  ocultar = "Esconder")

filtro_desemprego_ocde <- desemprego_ocde %>%
  arrange(periodo) %>%
  filter(codigo == first(codigo)) %>%
  slice(tail(row_number(), 72)) %>%
  pull(periodo)

d3plus(data = desemprego_ocde,
       id = "codigo",
       type = "line",
       percent_var = "valor",
       locale = "pt_BR",
       number_text = "%",
       dictionary = dic_desemprego_ocde,
       noformat_number_var = "valor") %>% 
  d3plusX("periodo", grid = FALSE) %>% 
  d3plusY("valor") %>% 
  d3plusOrder("periodo", sort = "asc") %>% 
  d3plusTooltip(c("pais", "periodo", "valor", "observacao")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id"), size = 40) %>%
  d3plusColor("codigo") %>%
  d3plusTime("periodo", solo = filtro_desemprego_ocde) %>%
  d3plusTitle(value = "Taxa de Desemprego por países",
              sub = "Taxa ajustada sazonalmente (OCDE)",
              font = list(size = 13, weight = 800))
```


### Taxa de Juros por países {.no-title}

```{r}
dic_juros_ocde <- list(
  valor = "Taxa",
  periodo = "Mês",
  observacao = "Observação",
  pais = "País",
  isolar = "Selecionar",
  ocultar = "Esconder")

filtro_juros_ocde <- juros_ocde %>%
  arrange(periodo) %>%
  filter(codigo == first(codigo)) %>%
  slice(tail(row_number(), 72)) %>%
  pull(periodo)

d3plus(data = juros_ocde %>%
                filter(!codigo == "TUR"), ## atualizável
       id = "codigo",
       type = "line",
       percent_var = "valor",
       locale = "pt_BR",
       number_text = "%",
       dictionary = dic_juros_ocde,
       noformat_number_var = "valor") %>% 
  d3plusX("periodo", grid = FALSE) %>% 
  d3plusY("valor") %>% 
  d3plusOrder("periodo", sort = "asc") %>% 
  d3plusTooltip(c("pais", "periodo", "valor", "observacao")) %>% 
  d3plusAxes(ticks = FALSE, background = list(color = "#FFFFFF", stroke = 0)) %>%
  d3plusLegend(value = TRUE, data = FALSE,
               order = list(value = "id"), size = 40) %>%
  d3plusColor("codigo") %>%
  d3plusTime("periodo", solo = filtro_juros_ocde) %>%
  d3plusTitle(value = "Taxa de Juros por países",
              sub = "Taxa interbancária em % a.a. - overnight (OCDE)",
              font = list(size = 13, weight = 800))
```


Sobre {data-icon="fa-file-alt"}
=====================================

### Sobre {.no-title}
#### **Painel Macro**
Este projeto tem objetivo de apresentar dados macroeconômicos de forma dinâmica e interativa, contemplando alguns temas e variáveis importantes para acompanhamento de conjuntura econômica. Dividido em seis temas, o painel traz possibilidade de filtrar períodos das séries temporais, desagregar dados e selecionar variáveis nos gráficos interativos. **Explore os dados**!  
**Importante**: para análises dos dados consulte os [Boletins de Conjuntura](https://gecefurg.com.br/boletins/boletim-macro/) do GECE.  
  
  


#### **Informações técnicas**
O painel foi criado utilizando **R**, uma linguagem de programação livre voltada para análise estatística, através da integração do **R Markdown** com o pacote `flexdashboard`, utilizado para criação de dashboards interativas. Os dados são extraídos de diversas fontes utilizando pacotes específicos disponibilizados no [CRAN](https://cran.r-project.org/), são tratados utilizando pacotes como `tidyverse`, `zoo`, `xts` e outros, e são apresentados graficamente com o pacote `D3plusR` e em tabelas com o `kableExtra`.  
  
  


#### **GECE**
Criado em agosto de 2017, o GECE tem como objetivo realizar análises de conjuntura econômica no que tange os principais indicadores macroeconômicos e ambientais. Atualmente é vinculado ao Instituto de Ciências Econômicas, Administrativas e Contábeis (ICEAC) da Universidade Federal do Rio Grande (FURG). Na área macroeconômica, as análises e boletins publicados são focados em nível de atividade, inflação, mercado de trabalho, economia internacional, política fiscal e monetária. Na área ambiental, são abordados temas como agricultura orgânica, agrotóxicos, biodiversidade, pesca, energia, florestas, unidades de conservação, saneamento e poluição.  
  
  


#### **Autor**
Fernando da Silva é graduado em Economia pela FURG, escreve sobre política monetária para o GECE, tem interesses em macroeconomic research, data analysis e linguagem de programação em R. Atualmente reside em Florianópolis/SC.  
Contato: <fernando@gecefurg.com.br>  
LinkedIn: <https://www.linkedin.com/in/schoulten/>  
  
  


#### **Dúvidas/sugestões/correções**
E-mail: <contato@gecefurg.com.br>



Fontes {data-icon="fa-table"}
=====================================

### Fontes {.no-title}
#### Fonte dos dados
Os dados são extraídos de diversas fontes, detalhadas abaixo, importados através de pacotes do **R** específicos.  
  
  
  

```{r}

fontes <- tibble(
  
  Tema = c(rep("Nível de Atividade", 8),
           
           rep("Inflação", 5),
           
           rep("Mercado de Trabalho", 7),
           
           rep("Política Fiscal", 7),
           
           rep("Política Monetária", 12),
           
           rep("Economia Internacional", 4)),
  
  
  `Variável` = c("Produto Interno Bruto - PIB", "Índice Cielo do Varejo Ampliado - ICVA", "Produção de Veículos (autoveículos total)", "Utilização da Capacidade Instalada - indústria de transformação", "Índice de Atividade Econômica Regional - IBCR", "Pesquisa Mensal de Comércio - PMC", "Pesquisa Mensal de Serviços - PMS", "Pesquisa Industrial Mensal - Produção Física - PIM-PF",
               
               "Índice Nacional de Preços ao Consumidor Amplo - IPCA", "Meta de inflação", "Índice de Difusão - IPCA", "Núcleos do IPCA", "Índice Geral de Preços - IGP",
               
               "Pessoas Ocupadas", "Pessoas Desocupadas", "Taxa de Desemprego", "Nível da Ocupação", "Taxa de Participação", "Rendimento", "Índice de Gini",
               
               "Resultado Primário do Governo Central", "Receita Líquida do Governo Central", "Despesa Total do Governo Central", "Saldo da Conta Única do Tesouro Nacional", "Classificação de Risco da Dívida", "Estoque da Dívida Pública Federal", "Composição da carteira de Títulos Públicos do Tesouro Nacional",
               
               "Meta da Taxa de Juros SELIC", "Meta de Inflação", "Expectativas de Inflação 12 meses à frente", "SELIC Meta", "SELIC Efetiva", "CDI", "Taxa de Juros Real (ex-ante e ex-post)", "Cotação de moedas (mercado cambial)", "Expectativas da Taxa SELIC", "Estrutura a Termo da Taxa de Juros - ETTJ", "Índice Bovespa", "Risco-Brasil EMBI+",
               
               "Produto Interno Bruto - PIB", "Taxa de Desemprego", "Taxa de Inflação", "Taxa de Juros"),
  
  
  Fonte = c("IBGE", "Cielo", "ANFAVEA", "FGV", "BCB", rep("IBGE", 3),
            
            "IBGE", "CMN", rep("BCB", 2), "FGV",
            
            rep("PNADC/IBGE", 6), "GECE (cálculo próprio)",
            
            rep("STN e IBGE", 3), "BCB e IBGE", "STN", "BCB e IBGE", "BCB",
            
            "COPOM/BCB", "CMN", rep("BCB", 4), "B3, BCB e IBGE", rep("BCB", 2), "ANBIMA", "B3", "JP Morgan",
            
            rep("OCDE", 4))
  )


fontes %>%
  kable(escape = FALSE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = T,
                position = "left",
                font_size = 12,
                fixed_thead = list(enabled = T, background = "#cbcdd1"),
                protect_latex = TRUE) %>%
  column_spec(1:3, bold = T)

```


